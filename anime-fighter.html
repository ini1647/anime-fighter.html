<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Anime Fighting Game (Prototype)</title>
<style>
  html,body{height:100%;margin:0;background:#0b0f1a;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}
  .wrap{display:flex;align-items:center;justify-content:center;height:100%}
  canvas{background:linear-gradient(#17304a,#081321);border-radius:8px;box-shadow:0 12px 40px rgba(0,0,0,.6)}
  .hud{position:fixed;left:50%;transform:translateX(-50%);top:18px;font-weight:700}
  .info{position:fixed;left:18px;bottom:18px;color:#ddd;font-size:13px}
  button{margin-left:8px;padding:6px 10px;border-radius:6px;border:0;background:#ff8b2b;color:#111;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
  <canvas id="c" width="960" height="540"></canvas>
</div>
<div class="hud" id="hud"></div>
<div class="info">
  Controls — P1: A/D move • W jump • J light • K heavy. 
  P2: ←/→ move • ↑ jump • N light • M heavy.
  <button id="toggleCpu">Toggle CPU (P2)</button>
  <button id="restart">Restart</button>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

let keys = {};
addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

const toggleCpuBtn = document.getElementById('toggleCpu');
const restartBtn = document.getElementById('restart');
let cpuControlled = false;
toggleCpuBtn.onclick = ()=> { cpuControlled = !cpuControlled; toggleCpuBtn.textContent = cpuControlled ? 'CPU: ON' : 'Toggle CPU (P2)'; }
restartBtn.onclick = ()=> init();

function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function sfx(freq=440, dur=0.06, vol=0.06){ try{ const a = new (window.AudioContext||window.webkitAudioContext)(); const o = a.createOscillator(); const g = a.createGain(); o.type='square'; o.frequency.value = freq; g.gain.value = vol; o.connect(g); g.connect(a.destination); o.start(); o.stop(a.currentTime + dur); }catch(e){} }

class Fighter {
  constructor(x,color,controls){
    this.x=x; this.y=H-160; this.w=50; this.h=100;
    this.vx=0; this.vy=0; this.color=color;
    this.health=100; this.facing=1; this.onGround=true;
    this.state='idle'; this.stun=0; this.controls=controls;
  }
  update(opponent){
    if(this.health<=0){this.state='down';return;}
    if(this.stun>0){this.stun--;return;}
    // Controls
    if(this.controls){
      if(keys[this.controls.left]) this.vx=-4, this.facing=-1, this.state='run';
      else if(keys[this.controls.right]) this.vx=4, this.facing=1, this.state='run';
      else this.vx=0, this.state='idle';
      if(keys[this.controls.jump] && this.onGround){this.vy=-12; this.onGround=false;}
      if(keys[this.controls.light]) this.attack(opponent,6,15);
      if(keys[this.controls.heavy]) this.attack(opponent,12,30);
    }
    // Gravity
    this.vy+=0.8; this.y+=this.vy; this.x+=this.vx;
    if(this.y>=H-160){this.y=H-160; this.vy=0; this.onGround=true;}
    this.x=clamp(this.x,0,W-this.w);
  }
  draw(){
    ctx.save();
    ctx.translate(this.x+this.w/2,this.y+this.h/2);
    ctx.scale(this.facing,1);
    ctx.fillStyle=this.color;
    ctx.fillRect(-this.w/2,-this.h/2,this.w,this.h);
    ctx.restore();
  }
  attack(opponent,damage,range){
    if(this.state.startsWith('attack'))return;
    this.state='attack';
    const hitRange=range*this.facing;
    const hitX=this.x+(this.facing===1?this.w: -range);
    if(Math.abs(hitX-opponent.x)<range && Math.abs(this.y-opponent.y)<80){
      opponent.takeHit(damage,this.facing);
    }
    sfx(440+Math.random()*200,0.1);
    setTimeout(()=>{this.state='idle';},300);
  }
  takeHit(dmg,dir){
    if(this.stun>0)return;
    this.health-=dmg; this.stun=20;
    this.vx=dir*6; this.vy=-4; this.state='hit';
    sfx(200,0.1,0.08);
  }
}

let f1,f2;
function init(){
  f1=new Fighter(200,'#00ffff',{left:'a',right:'d',jump:'w',light:'j',heavy:'k'});
  f2=new Fighter(700,'#ff5f5f',{left:'arrowleft',right:'arrowright',jump:'arrowup',light:'n',heavy:'m'});
}
init();

function update(){
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#202838'; ctx.fillRect(0,H-60,W,60);
  f1.update(f2);
  if(cpuControlled){
    // basic CPU
    if(Math.random()<0.02){
      if(f2.x>f1.x+60) f2.vx=-3;
      else if(f2.x<f1.x-60) f2.vx=3;
      else { f2.vx=0; f2.attack(f1,6,15); }
    }
    f2.x+=f2.vx;
  } else f2.update(f1);
  f1.draw(); f2.draw();
  // Health bars
  ctx.fillStyle='#fff';
  ctx.fillText('P1',30,30); ctx.fillText('P2',W-60,30);
  ctx.fillStyle='#0ff'; ctx.fillRect(60,20,f1.health*2,10);
  ctx.fillStyle='#f55'; ctx.fillRect(W-260,20,f2.health*2,10);
  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
